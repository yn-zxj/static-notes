import{_ as c,l as e,o as l,c as r,g as s,k as a,i as t,w as d,a as n}from"./app-ncqxSiYy.js";const i="/assets/running_status-xWtDvIHL.png",k="/assets/download_page-NHbkQhIm.png",u="/assets/rpm_package-WUH65FiA.png",m="/assets/error_install-0_XkeFr1.png",h="/assets/rpm_mysql_lib-bym0DBIB.png",g="/assets/password_mysql-Fpci19vz.png",y="/assets/mysqld_status-QZSn6Z4i.png",b="/assets/mysqld_process-eN0S96rd.png",_="/assets/mysql_login-dedjSuyg.png",w="/assets/set_password_1-gMkjeYcO.png",q="/assets/set_password_2-aI7_1YWR.png",v="/assets/validate_password-fydXMyTa.png",L="/assets/show_character_8-GhOP2VCl.png",f="/assets/show_character_5-5oBDzzWI.png",S="/assets/character_type-gmLixEey.png",x="/assets/charset--6bfHj8C.png",E="/assets/response_process-Ya_7RqFW.png",T={},A=n(`<h2 id="安装前说明" tabindex="-1"><a class="header-anchor" href="#安装前说明" aria-hidden="true">#</a> 安装前说明</h2><h3 id="linux-系统及工具准备" tabindex="-1"><a class="header-anchor" href="#linux-系统及工具准备" aria-hidden="true">#</a> Linux 系统及工具准备</h3><p>CentOS6 和 CentOS7 在 MySQL 的使用中的区别：</p><table><thead><tr><th></th><th>CentOS6</th><th>CentOS7</th></tr></thead><tbody><tr><td>防火墙</td><td>iptables</td><td>firewalld</td></tr><tr><td>启动服务</td><td>service</td><td>systemctl</td></tr></tbody></table><h3 id="查看是否安装过-mysql" tabindex="-1"><a class="header-anchor" href="#查看是否安装过-mysql" aria-hidden="true">#</a> 查看是否安装过 MySQL</h3><p>MySQL 版本查看：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">--version</span>
</code></pre></div><p>如果你是用 rpm 安装，检查一下 rpm package：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> mysql <span class="token comment"># -i 忽略大小写</span>
</code></pre></div><p>检查 mysql service：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>systemctl status mysqld.service
</code></pre></div><figure><img src="`+i+`" alt="运行状态.png" tabindex="0" loading="lazy"><figcaption>运行状态.png</figcaption></figure><h3 id="mysql-的卸载" tabindex="-1"><a class="header-anchor" href="#mysql-的卸载" aria-hidden="true">#</a> MySQL 的卸载</h3><p>① 关闭 mysql 服务</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>systemctl stop mysqld.service
</code></pre></div><p>② 查看当前 mysql 安装状态</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> mysql
<span class="token comment"># 或</span>
yum list installed <span class="token operator">|</span> <span class="token function">grep</span> mysql
</code></pre></div><p>③ 卸载上述命令查询出的已安装程序</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>yum remove mysql-xxx mysql-xxx
</code></pre></div><p>④ 删除 mysql 相关文件</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查找相关文件</span>
<span class="token function">find</span> / <span class="token parameter variable">-name</span> mysql

<span class="token comment"># 删除</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> xxx
</code></pre></div><p>⑤ 删除<code>my.cnf</code></p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/my.cnf
</code></pre></div><h2 id="mysql-的-linux-版的安装" tabindex="-1"><a class="header-anchor" href="#mysql-的-linux-版的安装" aria-hidden="true">#</a> MySQL 的 Linux 版的安装</h2><div class="hint-container tip"><p class="hint-container-title">MySQL 的四大版本</p><p><strong>MySQL Community Server 社区版本</strong>，开源免费，自由下载，但不提供官方技术支持，适用于大多数普通用户。</p><p><strong>MySQL Enterprise Edition 企业版本</strong>，需付费，不能在线下载，可以试用 30 天。提供了更多的功能和更完备的技术支持，更适合于对数据库的功能和可靠性要求较高的企业客户。</p><p><strong>MySQL Cluster 集群版</strong>，开源免费。用于架设集群服务器，可将几个 MySQL Server 封装成一个 Server。需要在社区版或企业版的基础上使用。</p><p><strong>MySQL Cluster CGE 高级集群版</strong>，需付费。</p></div><h3 id="下载-mysql-指定版本" tabindex="-1"><a class="header-anchor" href="#下载-mysql-指定版本" aria-hidden="true">#</a> 下载 MySQL 指定版本</h3>`,26),O={href:"https://dev.mysql.com/downloads/",target:"_blank",rel:"noopener noreferrer"},R=n('<p>② 点击<code>MySQL Community Server</code></p><p>③ 在<code>General Availability(GA) Releases</code>中选择适合的版本</p><figure><img src="'+k+'" alt="Dowload Page.png" tabindex="0" loading="lazy"><figcaption>Dowload Page.png</figcaption></figure><h3 id="linux-系统下安装-mysql-的几种方式" tabindex="-1"><a class="header-anchor" href="#linux-系统下安装-mysql-的几种方式" aria-hidden="true">#</a> Linux 系统下安装 MySQL 的几种方式</h3><h4 id="rpm-命令" tabindex="-1"><a class="header-anchor" href="#rpm-命令" aria-hidden="true">#</a> rpm 命令</h4><p>使用 rpm 命令安装扩展名为<code>.rpm</code>的软件包，其包的格式一般如下：</p><figure><img src="'+u+`" alt="RPM包格式.png" tabindex="0" loading="lazy"><figcaption>RPM包格式.png</figcaption></figure><hr><h4 id="yum-命令" tabindex="-1"><a class="header-anchor" href="#yum-命令" aria-hidden="true">#</a> yum 命令</h4><p>需联网，从 互联网获取 的 yum 源，直接使用 yum 命令安装</p><hr><h4 id="编译安装源码包" tabindex="-1"><a class="header-anchor" href="#编译安装源码包" aria-hidden="true">#</a> 编译安装源码包</h4><p>针对<code>tar.gz</code>这样的压缩格式，要用<code>tar</code>命令来解压；如果是其它压缩格式，就使用其它命令</p><h3 id="centos7-下检查-mysql-依赖" tabindex="-1"><a class="header-anchor" href="#centos7-下检查-mysql-依赖" aria-hidden="true">#</a> CentOS7 下检查 MySQL 依赖</h3><p>① 检查<code>/tmp</code>临时目录权限(必不可少)</p><p>由于安装过程中，会通过 mysql 用户在/tmp 目录下新建 tmp_db 文件，所以需要给它设置较大的权限，执行：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">777</span> /tmp
</code></pre></div><p>② 安装前检查依赖，不存在则需要安装</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> libaio
<span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> net-tools
</code></pre></div><h3 id="安装过程" tabindex="-1"><a class="header-anchor" href="#安装过程" aria-hidden="true">#</a> 安装过程</h3><p>① 将安装程序拷贝到<code>/opt</code>目录下</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 以抽离出来的mysql8为例，使用rpm安装</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-common-8.0.25-1.el7.x86_64.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-client-plugins-8.0.25-1.el7.x86_64.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-libs-8.0.25-1.el7.x86_64.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-client-8.0.25-1.el7.x86_64.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-server-8.0.25-1.el7.x86_64.rpm
</code></pre></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>① 必须按照上面顺序执行<br> ② 如果没有检查 mysql 依赖环境，在安装 mysql-community-server 会报错<br> ③ 命令说明</p><blockquote><p>rpm：Redhat Package Manage，通过 RPM 的管理，用户可以把源代码包装成以 rpm 为扩展名的文件形式，易于安装<br> -i：--install，安装软件包<br> -v：--verbose，提供更多的详细信息输出<br> -h：--hash，软件包安装的时候列出哈希标记，展示进度条</p></blockquote><p>④ 可能遇到的报错，使用<code>yum remove mysql-libs</code>，清除之前安装过的依赖即可</p><figure><img src="`+m+`" alt="报错.png" tabindex="0" loading="lazy"><figcaption>报错.png</figcaption></figure></div><p>② 查看 MySQL 版本</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看版本</span>
mysql <span class="token parameter variable">--version</span>

<span class="token comment"># 查看是否安装成功</span>
<span class="token function">rpm</span> -qa<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-i</span> mysql
</code></pre></div><figure><img src="`+h+`" alt="安装验证.png" width="500" tabindex="0" loading="lazy"><figcaption>安装验证.png</figcaption></figure><p>③ 服务的初始化</p><p>为了保证数据库目录与文件的所有者为 mysql 登录用户，如果你是以 root 身份运行 mysql 服务，需要执<br> 行下面的命令初始化：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>mysqld <span class="token parameter variable">--initialize</span> <span class="token parameter variable">--user</span><span class="token operator">=</span>mysql
</code></pre></div><blockquote><p>说明： <code>--initialize</code> 选项默认以&quot;安全&quot;模式来初始化，则会为 root 用户生成一个密码并将 该密码标记为过期，登录后你需要设置一个新的密码。生成的 临时密码 会往日志中记录一份</p></blockquote><p>查看密码：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># root@localhost: 后面就是初始化的密码</span>
<span class="token function">cat</span> /var/log/mysqld.log
</code></pre></div><figure><img src="`+g+`" alt="查看密码.png" tabindex="0" loading="lazy"><figcaption>查看密码.png</figcaption></figure><p>④ 启动 MySQL，查看状态</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># .service后缀可以省略</span>
<span class="token comment"># 启动</span>
systemctl start mysqld.service
<span class="token comment"># 关闭</span>
systemctl stop mysqld.service
<span class="token comment"># 重启</span>
systemctl restart mysqld.service
<span class="token comment"># 查看状态</span>
systemctl status mysqld.service
</code></pre></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>mysqld 这个可执行文件就代表着 MySQL 服务器程序，运行这个可执行文件就可以直接启动一个服务器进程</p><figure><img src="`+y+'" alt="启动状态.png" tabindex="0" loading="lazy"><figcaption>启动状态.png</figcaption></figure><p>查看进程：<code>ps -ef | grep mysqld</code></p><figure><img src="'+b+`" alt="查看进程.png" tabindex="0" loading="lazy"><figcaption>查看进程.png</figcaption></figure></div><p>⑤ 查看服务是否自启动</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>systemctl list-unit-files<span class="token operator">|</span><span class="token function">grep</span> mysqld.service
</code></pre></div><blockquote><p>默认是 enable，如果不是可以运行下面命令进行设置：</p></blockquote><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 开启自启动</span>
systemctl <span class="token builtin class-name">enable</span> mysqld.service
<span class="token comment"># 关闭自启动</span>
systemctl disable mysqld.service
</code></pre></div><h2 id="mysql-登录" tabindex="-1"><a class="header-anchor" href="#mysql-登录" aria-hidden="true">#</a> MySQL 登录</h2><h3 id="首次登录" tabindex="-1"><a class="header-anchor" href="#首次登录" aria-hidden="true">#</a> 首次登录</h3><p>通过命令<code>mysql -hlocalhost -P3306 -uroot -p</code>进行登录，在<code>Enter password:</code>输入初始化密码(上面 mysqld.log 中获取的密码)</p><figure><img src="`+_+`" alt="登录.png" tabindex="0" loading="lazy"><figcaption>登录.png</figcaption></figure><h3 id="修改密码" tabindex="-1"><a class="header-anchor" href="#修改密码" aria-hidden="true">#</a> 修改密码</h3><p>因为初始化密码默认是过期的，所以查看数据库会报错，修改密码：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">&#39;root&#39;</span><span class="token variable">@&#39;localhost&#39;</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">&#39;new_password&#39;</span><span class="token punctuation">;</span>
</code></pre></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>5.7 版本之后（不含 5.7），mysql 加入了全新的密码安全机制，设置新密码太简单会报错。</p><figure><img src="`+w+'" alt="密码设置.png" tabindex="0" loading="lazy"><figcaption>密码设置.png</figcaption></figure><p>改为更复杂的密码规则之后，设置成功，可以正常使用数据库了</p><figure><img src="'+q+`" alt="密码设置.png" tabindex="0" loading="lazy"><figcaption>密码设置.png</figcaption></figure></div><h3 id="设置远程登录" tabindex="-1"><a class="header-anchor" href="#设置远程登录" aria-hidden="true">#</a> 设置远程登录</h3><p>在远程连接 MySQL 数据库时，可能会遇到连接不上的情况，需要进行问题排查。</p><hr><h4 id="确认网络" tabindex="-1"><a class="header-anchor" href="#确认网络" aria-hidden="true">#</a> <u>确认网络</u></h4><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 检查与远程主机网络是否通畅</span>
<span class="token function">ping</span> ip_addr

<span class="token comment"># 检查远程主机端口是否开放</span>
telnet ip_addr port
</code></pre></div><p><strong>关闭防火墙或开放端口</strong>：</p><p>方式一：关闭防火墙</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># CentOS6</span>
<span class="token function">service</span> iptables stop

<span class="token comment"># CentOS7</span>
systemctl status firewalld.service <span class="token comment"># 查看状态</span>
systemctl start firewalld.service <span class="token comment"># 开启</span>
systemctl stop firewalld.service <span class="token comment"># 关闭</span>
systemctl <span class="token builtin class-name">enable</span> firewalld.service <span class="token comment">#设置开机启用防火墙</span>
systemctl disable firewalld.service <span class="token comment">#设置开机禁用防火墙</span>
</code></pre></div><p>方式二：开放端口</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看开放的端口号</span>
firewall-cmd --list-all

<span class="token comment"># 设置开放的端口号</span>
firewall-cmd --add-service<span class="token operator">=</span>http <span class="token parameter variable">--permanent</span>
firewall-cmd --add-port<span class="token operator">=</span><span class="token number">3306</span>/tcp <span class="token parameter variable">--permanent</span>

<span class="token comment"># 重启防火墙</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre></div><h4 id="linux-下修改配置" tabindex="-1"><a class="header-anchor" href="#linux-下修改配置" aria-hidden="true">#</a> <u>Linux 下修改配置</u></h4><p>在 Linux 系统 MySQL 下测试，可以看到 root 用户的当前主机配置信息为 localhost</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">use</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">select</span> Host<span class="token punctuation">,</span><span class="token keyword">User</span> <span class="token keyword">from</span> <span class="token keyword">user</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">-----------+---------------+</span>
<span class="token operator">|</span> Host      <span class="token operator">|</span> <span class="token keyword">User</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+---------------+</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span> <span class="token operator">|</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys     <span class="token operator">|</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> root          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+---------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><div class="hint-container tip"><p class="hint-container-title">修改 Host 为通配符%</p><p>  Host 列指定了允许用户登录所使用的 IP，比如<code>user=root Host=192.168.1.1</code>，表示 root 用户只能通过 192.168.1.1 的客户端去访问。 <code>user=root Host=localhost</code>表示只能通过本机客户端去访问。而<code>%</code>是个通配符，如果<code>Host=192.168.1.%</code>，就表示只要 IP 地址前缀是<code>192.168.1.</code>的客户端都可以连接。如果<code>Host=%</code>，表示所有 IP 都有连接权限。</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> host <span class="token operator">=</span> <span class="token string">&#39;%&#39;</span> <span class="token keyword">where</span> <span class="token keyword">user</span> <span class="token operator">=</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># 刷新权限</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre></div><p><mark>注意：在生产环境下不能为了省事将 host 设置为%，这样做会存在安全问题，具体的设置可以根据生产环境的 IP 进行设置</mark>。</p></div>`,62),M=s("code",null,"'caching_sha2_password' cannot be loaded",-1),N=n(`<h2 id="mysql-8-的密码轻度评估-了解" tabindex="-1"><a class="header-anchor" href="#mysql-8-的密码轻度评估-了解" aria-hidden="true">#</a> MySQL 8 的密码轻度评估(了解)</h2><h3 id="mysql-不同版本设置密码-可能出现" tabindex="-1"><a class="header-anchor" href="#mysql-不同版本设置密码-可能出现" aria-hidden="true">#</a> MySQL 不同版本设置密码(可能出现)</h3><p>MySQL5.7 中：成功</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">&#39;root&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;abcd1234&#39;</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>MySQL8.0 中：失败</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">&#39;root&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;abcd1234&#39;</span><span class="token punctuation">;</span>
ERROR <span class="token number">1819</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Your password does <span class="token operator">not</span> satisfy the <span class="token keyword">current</span> policy requirements
</code></pre></div><h3 id="mysql-8-之前的安全策略" tabindex="-1"><a class="header-anchor" href="#mysql-8-之前的安全策略" aria-hidden="true">#</a> MySQL 8 之前的安全策略</h3><p>在 MySQL 8.0 之前，MySQL 使用的是 validate_password 插件检测、验证账号密码强度，保障账号的安全性。</p><h4 id="方式一-在参数文件-my-cnf-中添加参数" tabindex="-1"><a class="header-anchor" href="#方式一-在参数文件-my-cnf-中添加参数" aria-hidden="true">#</a> 方式一：在参数文件 my.cnf 中添加参数</h4><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
plugin<span class="token operator">-</span><span class="token keyword">load</span><span class="token operator">-</span><span class="token keyword">add</span><span class="token operator">=</span>validate_password<span class="token punctuation">.</span>so
<span class="token comment"># ON/OFF/FORCE/FORCE_PLUS_PERMANENT: 是否使用该插件(及强制/永久强制使用)</span>
validate<span class="token operator">-</span>password<span class="token operator">=</span>FORCE_PLUS_PERMANENT
</code></pre></div><blockquote><p>① plugin library 中的 validate_password 文件名的后缀名根据平台不同有所差异。 对于 Unix 和 Unix-like 系统而言，它的文件后缀名是<code>.so</code>，对于 Windows 系统而言，它的文件后缀名是<code>.dll</code></p><p>② 修改参数后必须重启 MySQL 服务才能生效</p><p>③ 参数 FORCE_PLUS_PERMANENT 是为了防止插件在 MySQL 运行时的时候被卸载。当你卸载插件时就会报错。如下所示：</p></blockquote><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> PLUGIN_NAME<span class="token punctuation">,</span> PLUGIN_LIBRARY<span class="token punctuation">,</span> PLUGIN_STATUS<span class="token punctuation">,</span> LOAD_OPTION
       <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span>PLUGINS
       <span class="token keyword">WHERE</span> PLUGIN_NAME <span class="token operator">=</span> <span class="token string">&#39;validate_password&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------+----------------------+---------------+----------------------+</span>
<span class="token operator">|</span> PLUGIN_NAME       <span class="token operator">|</span> PLUGIN_LIBRARY       <span class="token operator">|</span> PLUGIN_STATUS <span class="token operator">|</span> LOAD_OPTION          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+----------------------+---------------+----------------------+</span>
<span class="token operator">|</span> validate_password <span class="token operator">|</span> validate_password<span class="token punctuation">.</span>so <span class="token operator">|</span> ACTIVE        <span class="token operator">|</span> FORCE_PLUS_PERMANENT <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+----------------------+---------------+----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> UNINSTALL PLUGIN validate_password<span class="token punctuation">;</span>
ERROR <span class="token number">1702</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Plugin <span class="token string">&#39;validate_password&#39;</span> <span class="token operator">is</span> force_plus_permanent <span class="token operator">and</span> can <span class="token operator">not</span> be unloaded
</code></pre></div><h4 id="方式二-运行时命令安装" tabindex="-1"><a class="header-anchor" href="#方式二-运行时命令安装" aria-hidden="true">#</a> 方式二：运行时命令安装</h4><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>INSTALL PLUGIN validate_password <span class="token keyword">SONAME</span> <span class="token string">&#39;validate_password.so&#39;</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>此方法也会注册到元数据，也就是 mysql.plugin 表中，所以不用担心 MySQL 重启后插件会失效</p></blockquote><h3 id="mysql-8-的安全策略" tabindex="-1"><a class="header-anchor" href="#mysql-8-的安全策略" aria-hidden="true">#</a> MySQL 8 的安全策略</h3><h4 id="validate-password-说明" tabindex="-1"><a class="header-anchor" href="#validate-password-说明" aria-hidden="true">#</a> validate_password 说明</h4><p>  MySQL 8.0 引入了服务器组件（Components）这个特性，validate_password 插件已用服务器组件重新实现。8.0.25 版本的数据库中，默认自动安装 validate_password 组件。</p><p><mark>未安装插件前，执行如下两个指令</mark>，执行效果：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;validate_password%&#39;</span><span class="token punctuation">;</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span>component<span class="token punctuation">;</span>
ERROR <span class="token number">1146</span> <span class="token punctuation">(</span><span class="token number">42</span>S02<span class="token punctuation">)</span>: <span class="token keyword">Table</span> <span class="token string">&#39;mysql.component&#39;</span> doesn&#39;t exist
</code></pre></div><p><mark>安装插件后，执行如下两个指令</mark>，执行效果：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;validate_password%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token operator">|</span> Variable_name                        <span class="token operator">|</span> <span class="token keyword">Value</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>check_user_name    <span class="token operator">|</span> <span class="token keyword">ON</span>     <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>dictionary_file    <span class="token operator">|</span>        <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>length             <span class="token operator">|</span> <span class="token number">8</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>mixed_case_count   <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>number_count       <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>policy             <span class="token operator">|</span> MEDIUM <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>special_char_count <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span>component<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------------+------------------------------------+</span>
<span class="token operator">|</span> component_id <span class="token operator">|</span> component_group_id <span class="token operator">|</span> component_urn                      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------------+------------------------------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>            <span class="token operator">|</span> <span class="token number">1</span>                  <span class="token operator">|</span> <span class="token keyword">file</span>:<span class="token comment">//component_validate_password |</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------------+------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>关于<code>validate_password</code>组件对应的系统变量说明：</p><figure><img src="`+v+`" alt="参数说明.png" tabindex="0" loading="lazy"><figcaption>参数说明.png</figcaption></figure><blockquote><p>提示：组件和插件的默认值可能有所不同。例如，MySQL 5.7. validate_password_check_user_name 的默认值为 OFF。</p></blockquote><h4 id="修改安全策略" tabindex="-1"><a class="header-anchor" href="#修改安全策略" aria-hidden="true">#</a> 修改安全策略</h4><p>修改密码验证安全强度：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> validate_password_policy <span class="token operator">=</span> LOW<span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> validate_password_policy <span class="token operator">=</span> MEDIUM<span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> validate_password_policy <span class="token operator">=</span> STRONG<span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> validate_password_policy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment"># For LOW</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> validate_password_policy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment"># For MEDIUM</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> validate_password_policy <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment"># For HIGH</span>

<span class="token comment"># 注意：如果是插件的话，SQL为set global validate_password_policy = LOW</span>
</code></pre></div><p>此外，还可以修改密码中字符的长度：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> validate_password_length <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="密码强度测试" tabindex="-1"><a class="header-anchor" href="#密码强度测试" aria-hidden="true">#</a> 密码强度测试</h4><p>  如果你创建密码是遇到<code>Your password does not satisfy the current policy requirements</code>，可以通过函数组件去检测密码是否满足条件： 0-100。当评估在 100 时就是说明使用上了最基本的规则：大写+小写+特殊字符+数字组成的 8 位以上密码</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> VALIDATE_PASSWORD_STRENGTH<span class="token punctuation">(</span><span class="token string">&#39;weak&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------------------+</span>
<span class="token operator">|</span> VALIDATE_PASSWORD_STRENGTH<span class="token punctuation">(</span><span class="token string">&#39;weak&#39;</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------+</span>
<span class="token operator">|</span>                                 <span class="token number">25</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------+</span>
</code></pre></div><div class="hint-container warning"><p class="hint-container-title">注意</p><p>如果没有安装 validate_password 组件或插件的话，那么这个函数永远都返回 0。 关于密码复杂度对应的密码复杂度策略。如下表格所示：</p><table><thead><tr><th>Password Test Return</th><th>Value</th></tr></thead><tbody><tr><td>Length &lt; 4</td><td>0</td></tr><tr><td>Length ≥ 4 and &lt; validate_password.length</td><td>25</td></tr><tr><td>Satisfies policy 1 (LOW)</td><td>50</td></tr><tr><td>Satisfies policy 2 (MEDIUM)</td><td>75</td></tr><tr><td>Satisfies policy 3 (STRONG)</td><td>100</td></tr></tbody></table></div><h3 id="卸载插件或组件" tabindex="-1"><a class="header-anchor" href="#卸载插件或组件" aria-hidden="true">#</a> 卸载插件或组件</h3><p><strong>卸载插件</strong>：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>UNINSTALL PLUGIN plugin_name
<span class="token comment"># 例如</span>
UNINSTALL PLUGIN validate_password<span class="token punctuation">;</span>
</code></pre></div><p><strong>卸载组件</strong>：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>UNINSTALL COMPONENT component_name <span class="token punctuation">[</span><span class="token punctuation">,</span> component_name <span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment"># 例如</span>
UNINSTALL COMPONENT <span class="token string">&#39;file://component_validate_password&#39;</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="字符集的相关操作" tabindex="-1"><a class="header-anchor" href="#字符集的相关操作" aria-hidden="true">#</a> 字符集的相关操作</h2><h3 id="修改-mysql-5-7-字符集" tabindex="-1"><a class="header-anchor" href="#修改-mysql-5-7-字符集" aria-hidden="true">#</a> 修改 MySQL 5.7 字符集</h3><h4 id="修改步骤" tabindex="-1"><a class="header-anchor" href="#修改步骤" aria-hidden="true">#</a> 修改步骤</h4><p>  在 MySQL8.0 版本之前，默认字符集为<code>latin1</code>，<code>utf8</code>字符集指向的是<code>utf8mb3</code>。网站开发人员在数据库设计的时候往往会将编码修改为 utf8 字符集。如果遗忘修改默认的编码，就会出现乱码的问题。从 MySQL8.0 开始，数据库的默认编码将改为<code>utf8mb4</code>，从而避免上述乱码的问题。</p><p><strong>查看默认使用的字符集</strong>：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;character%&#39;</span><span class="token punctuation">;</span>
</code></pre></div><figure><img src="`+L+'" alt="MySQL8.0 默认字符集.png" tabindex="0" loading="lazy"><figcaption>MySQL8.0 默认字符集.png</figcaption></figure><figure><img src="'+f+`" alt="MySQL5.7 默认字符集.png" tabindex="0" loading="lazy"><figcaption>MySQL5.7 默认字符集.png</figcaption></figure><blockquote><p>MySQL 5.7 默认的客户端和服务器都用了<mark>latin1</mark> ，不支持中文，保存中文会报错。</p></blockquote><p><strong>修改字符集</strong>：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 找到MySQL配置文件</span>
vim <span class="token operator">/</span>etc<span class="token operator">/</span>my<span class="token punctuation">.</span>cnf

<span class="token comment"># 文件中增加中文字符集配置</span>
character_set_server<span class="token operator">=</span>utf8

<span class="token comment"># 重启MySQL服务</span>
systemctl restart mysqld
</code></pre></div><blockquote><p>注意：此处修改后，原库和原表的设定不会发生变化，参数修改只对新建的数据库生效。</p></blockquote><h4 id="已有库或表字符集变更" tabindex="-1"><a class="header-anchor" href="#已有库或表字符集变更" aria-hidden="true">#</a> 已有库或表字符集变更</h4><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 修改已创建数据库的字符集</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> database_name <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token string">&#39;character_name&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># 例如</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> proddb <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">;</span>

<span class="token comment"># 修改已创建数据表的字符集</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> table_name <span class="token keyword">convert</span> <span class="token keyword">to</span> <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token string">&#39;character_name&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># 例如</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> employees <span class="token keyword">convert</span> <span class="token keyword">to</span> <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意：原有的数据如果是用非<code>utf8</code>编码的话，数据本身编码不会发生改变。已有数据需要导出或删除，然后重新插入。</p></blockquote><h3 id="各级别的字符集" tabindex="-1"><a class="header-anchor" href="#各级别的字符集" aria-hidden="true">#</a> 各级别的字符集</h3><p>MySQL 有四个级别的字符集和比较规则，分别是：服务器级别、数据库级别、表级别、列级别</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;character%&#39;</span><span class="token punctuation">;</span>
</code></pre></div><figure><img src="`+S+`" alt="各级别字符集.png" tabindex="0" loading="lazy"><figcaption>各级别字符集.png</figcaption></figure><table><thead><tr><th>字符集级别</th><th>说明</th></tr></thead><tbody><tr><td><code>character_set_server</code></td><td>服务器级别的字符集</td></tr><tr><td><code>character_set_database</code></td><td>当前数据库的字符集</td></tr><tr><td><code>character_set_client</code></td><td>服务器解码请求时使用的字符集</td></tr><tr><td><code>character_set_connection</code></td><td>服务器处理请求时会把请求字符串从 character_set_client 转为 character_set_connection</td></tr><tr><td><code>character_set_results</code></td><td>服务器向客户端返回数据时使用的字符集</td></tr></tbody></table><hr><h4 id="服务器级别-character-set-server" tabindex="-1"><a class="header-anchor" href="#服务器级别-character-set-server" aria-hidden="true">#</a> 服务器级别：<code>character_set_server</code></h4><p>  启动服务器程序时通过启动选项或者在服务器程序运行过程中使用 SET 语句修改这两个变量的值，在配置文件中可以这么写：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>[server]
character_set_server=gbk # 默认字符集
collation_server=gbk_chinese_ci # 对应的默认字符集的比较规则
</code></pre></div><p>  当服务器启动的时候读取这个配置文件后这两个系统变量的值便修改了。</p><hr><h4 id="数据库级别-character-set-database" tabindex="-1"><a class="header-anchor" href="#数据库级别-character-set-database" aria-hidden="true">#</a> 数据库级别：<code>character_set_database</code></h4><p>  创建和修改数据库的时候可以指定该数据库的字符集和比较规则，具体语法如下：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 数据库名
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> 字符集名称<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">COLLATE</span> 比较规则名称<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> 数据库名
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> 字符集名称<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">COLLATE</span> 比较规则名称<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><hr><h4 id="表级别" tabindex="-1"><a class="header-anchor" href="#表级别" aria-hidden="true">#</a> 表级别</h4><p>  在创建和修改表的时候指定表的字符集和比较规则，语法如下：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名 <span class="token punctuation">(</span>列的信息<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> 字符集名称<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token keyword">COLLATE</span> 比较规则名称<span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> 字符集名称<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token keyword">COLLATE</span> 比较规则名称<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>如果创建和修改表的语句中<mark>没有指明字符集和比较规则，将使用该表所在数据库的字符集和比较规则作为该表的字符集和比较规则</mark>。</p></blockquote><hr><h4 id="列级别" tabindex="-1"><a class="header-anchor" href="#列级别" aria-hidden="true">#</a> 列级别</h4><p>  对于存储字符串的列，同一个表中的不同的列也可以有不同的字符集和比较规则。我们在创建和修改列定义的时候可以指定该列的字符集和比较规则，语法如下：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名<span class="token punctuation">(</span>
  列名 字符串类型 <span class="token punctuation">[</span><span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> 字符集名称<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">COLLATE</span> 比较规则名称<span class="token punctuation">]</span><span class="token punctuation">,</span>
  其他列<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名
  <span class="token keyword">MODIFY</span> 列名 字符串类型 <span class="token punctuation">[</span><span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> 字符集名称<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">COLLATE</span> 比较规则名称<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><hr><h4 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h4><p>我们介绍的这 4 个级别字符集和比较规则的联系如下：<br>  ① 如果<mark>创建或修改列</mark>时没有显式的指定字符集和比较规则，则该列<mark>默认用表</mark>的字符集和比较规则；<br>  ② 如果<mark>创建表时</mark>没有显式的指定字符集和比较规则，则该表<mark>默认用数据库的</mark>字符集和比较规则；<br>  ③ 如果<mark>创建数据库时</mark>没有显式的指定字符集和比较规则，则该数据库<mark>默认用服务器的</mark>字符集和比较规则。</p><h3 id="字符集与比较规则-了解" tabindex="-1"><a class="header-anchor" href="#字符集与比较规则-了解" aria-hidden="true">#</a> 字符集与比较规则(了解)</h3><h4 id="utf8-与-utf8mb4" tabindex="-1"><a class="header-anchor" href="#utf8-与-utf8mb4" aria-hidden="true">#</a> utf8 与 utf8mb4</h4><p>  utf8 字符集表示一个字符需要使用 1 ～ 4 个字节，但是我们常用的一些字符使用 1 ～ 3 个字节就可以表示了，而字符集表示一个字符所用的最大字节长度，在某些方面会影响系统的存储和性能，所以设计 MySQL 的设计者偷偷的定义了两个概念：<br>  ① <code>utf8mb3</code>：阉割过的 utf8 字符集，只使用 1 ～ 3 个字节表示字符。<br>  ② <code>utf8mb4</code>：正宗的 utf8 字符集，使用 1 ～ 4 个字节表示字符。</p><h4 id="比较规则" tabindex="-1"><a class="header-anchor" href="#比较规则" aria-hidden="true">#</a> 比较规则</h4><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 字符集查看</span>
<span class="token keyword">show</span> <span class="token keyword">charset</span><span class="token punctuation">;</span>

<span class="token comment"># 比较规则查看</span>
<span class="token keyword">show</span> collation<span class="token punctuation">;</span>
</code></pre></div><figure><img src="`+x+`" alt="MySQL支持的字符集.png" tabindex="0" loading="lazy"><figcaption>MySQL支持的字符集.png</figcaption></figure><blockquote><p>最后一列<code>Maxlen</code>，它代表该种字符集表示一个字符最多需要几个字节</p></blockquote><p>  上表中，MySQL 版本一共支持 41 种字符集，其中的<code>Default collation</code>列表示这种字符集中一种默认的比较规则，里面包含着该比较规则主要作用于哪种语言，比如<code>utf8_polish_ci</code>表示以波兰语的规则比较，<code>utf8_spanish_ci</code>是以西班牙语的规则比较，<code>utf8_general_ci</code>是一种通用的比较规则。后缀表示该比较规则是否区分语言中的重音、大小写。具体如下：</p><table><thead><tr><th>后缀</th><th>英文释义</th><th>描述</th></tr></thead><tbody><tr><td><code>_ai</code></td><td><code>accent insensitive</code></td><td>不区分重音</td></tr><tr><td><code>_as</code></td><td><code>accent sensitive</code></td><td>区分重音</td></tr><tr><td><code>_ci</code></td><td><code>case insensitive</code></td><td>不区分大小写</td></tr><tr><td><code>_cs</code></td><td><code>case sensitive</code></td><td>区分大小写</td></tr><tr><td><code>_bin</code></td><td><code>binary</code></td><td>以二进制方式比较</td></tr></tbody></table><p><strong>常用操作</strong>：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 查看UTF-8字符集</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CHARSET</span> <span class="token operator">LIKE</span> <span class="token string">&#39;utf8%&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># 查看UTF-8字符集的比较规则</span>
<span class="token keyword">SHOW</span> COLLATION <span class="token operator">LIKE</span> <span class="token string">&#39;utf8%&#39;</span><span class="token punctuation">;</span>

<span class="token comment"># 查看服务器的字符集和比较规则</span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;%_server&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># 查看数据库的字符集和比较规则</span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;%_database&#39;</span><span class="token punctuation">;</span>

<span class="token comment"># 查看具体数据库的字符集</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> database_name<span class="token punctuation">;</span>

<span class="token comment"># 修改具体数据库的字符集</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> database_name <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">&#39;字符集&#39;</span> <span class="token keyword">COLLATE</span> <span class="token string">&#39;比较规则&#39;</span><span class="token punctuation">;</span>

<span class="token comment"># 查看表的字符集</span>
<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> table_name<span class="token punctuation">;</span>
<span class="token comment"># 查看表的比较规则</span>
<span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token keyword">from</span> database_name <span class="token operator">like</span> <span class="token string">&#39;real_table_name&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># 修改表的字符集和比较规则</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">&#39;字符集&#39;</span> <span class="token keyword">COLLATE</span> <span class="token string">&#39;比较规则&#39;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="请求到响应过程中字符集的变化" tabindex="-1"><a class="header-anchor" href="#请求到响应过程中字符集的变化" aria-hidden="true">#</a> 请求到响应过程中字符集的变化</h3><table><thead><tr><th>系统变量</th><th>描述</th></tr></thead><tbody><tr><td><code>character_set_client</code></td><td>服务器解码请求时使用的字符集</td></tr><tr><td><code>character_set_connection</code></td><td>服务器处理请求时会把请求字符串从 character_set_client 转为 character_set_connection</td></tr><tr><td><code>character_set_results</code></td><td>服务器向客户端返回数据时使用的字符集</td></tr></tbody></table><p>总结图示：</p><figure><img src="`+E+`" alt="请求响应过程.png" tabindex="0" loading="lazy"><figcaption>请求响应过程.png</figcaption></figure><h2 id="sql-大小写规范" tabindex="-1"><a class="header-anchor" href="#sql-大小写规范" aria-hidden="true">#</a> SQL 大小写规范</h2><h3 id="windows-和-linux-平台区别" tabindex="-1"><a class="header-anchor" href="#windows-和-linux-平台区别" aria-hidden="true">#</a> Windows 和 Linux 平台区别</h3><p>  在 SQL 中，关键字和函数名是不用区分字母大小写的，比如 SELECT、WHERE、ORDER、GROUP BY 等关键字，以及 ABS、MOD、ROUND、MAX 等函数名。</p><p>  不过在 SQL 中，你还是要确定大小写的规范，因为在 Linux 和 Windows 环境下，你可能会遇到不同的大小写问题。 <mark>windows 系统默认大小写不敏感</mark> ，但是 <mark>linux 系统是大小写敏感的</mark>。</p><p>通过如下命令查看：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;%lower_case_table_names%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
<span class="token operator">|</span> Variable_name          <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
<span class="token operator">|</span> lower_case_table_names <span class="token operator">|</span> <span class="token number">1</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>
</code></pre></div><blockquote><p><code>lower_case_table_names</code>参数值的设置：<br>  ① 默认为 0，大小写敏感；<br>  ② 设置 1，大小写不敏感。创建的表，数据库都是以小写形式存放在磁盘上，对于 sql 语句都是转换为小写对表和数据库进行查找；<br>  ③ 设置 2，创建的表和数据库依据语句上格式存放，凡是查找都是转换为小写进行。</p></blockquote><div class="hint-container tip"><p class="hint-container-title">提示</p><p><strong>MySQL 在 Linux 下数据库名、表名、列名、别名大小写规则是这样的</strong>：<br>  ① 数据库名、表名、表的别名、变量名是严格区分大小写的；<br>  ② 关键字、函数名称在 SQL 中不区分大小写；<br>  ③ 列名（或字段名）与列的别名（或字段别名）在所有的情况下均是忽略大小写的；</p><p><strong>MySQL 在 Windows 的环境下全部不区分大小写</strong></p></div><h3 id="linux-下大小写规则设置" tabindex="-1"><a class="header-anchor" href="#linux-下大小写规则设置" aria-hidden="true">#</a> Linux 下大小写规则设置</h3><p>  想设置为大小写不敏感时，要在<code>my.cnf</code>这个配置文件<code>[mysqld]</code>中加入<code>lower_case_table_names=1</code>，然后重启服务器，但是要在重启数据库实例之前就需要将原来的数据库和表转换为小写，否则将找不到数据库名。</p><p>  此外此方式适用于 MySQL 5.7，在 MySQL 8 下禁止在重新启动服务时将其值设置成不同于初始化时设置的值。如果非要修改，修改步骤为：</p><div class="language-text" data-ext="text"><pre class="language-text"><code>1.停止MySQL服务
2.删除数据目录，即删除 /var/lib/mysql 目录
3.在MySQL配置文件(/etc/my.cnf)中添加 lower_case_table_names=1
4.启动MySQL服务
</code></pre></div><h3 id="sql-编写建议" tabindex="-1"><a class="header-anchor" href="#sql-编写建议" aria-hidden="true">#</a> SQL 编写建议</h3><div class="hint-container tip"><p class="hint-container-title">有关命名规范的建议：</p><p> ① 关键字和函数名称全部大写；<br>  ② 数据库名、表名、表别名、字段名、字段别名等全部小写；<br>  ③ SQL 语句必须以分号结尾。</p></div><p>  数据库名、表名和字段名在 Linux MySQL 环境下是区分大小写的，因此建议你统一这些字段的命名规则，比如全部采用小写的方式。</p><p>  虽然关键字和函数名称在 SQL 中不区分大小写，也就是如果小写的话同样可以执行。但是同时将关键词和函数名称全部大写，以便于区分数据库名、表名、字段名。</p><h2 id="sql-mode-的合理设置" tabindex="-1"><a class="header-anchor" href="#sql-mode-的合理设置" aria-hidden="true">#</a> sql_mode 的合理设置</h2><h3 id="宽松模式与严格模式" tabindex="-1"><a class="header-anchor" href="#宽松模式与严格模式" aria-hidden="true">#</a> 宽松模式与严格模式</h3><h4 id="宽松模式" tabindex="-1"><a class="header-anchor" href="#宽松模式" aria-hidden="true">#</a> 宽松模式</h4><p>  如果设置的是宽松模式，那么我们在插入数据的时候，即便是给了一个错误的数据，也可能会被接受，并且不报错。</p><p><strong>应用场景</strong>：通过设置 sql mode 为宽松模式，来保证大多数 sql 符合标准的 sql 语法，这样应用在不同数据库之间进行 迁移 时，则不需要对业务 sql 进行较大的修改。</p><blockquote><p>列举：我在创建一个表时，该表中有一个字段为 name，给 name 设置的字段类型时 char(10) ，如果我在插入数据的时候，其中 name 这个字段对应的有一条数据的 长度超过了 10 ，例如<code>1234567890abc</code>，超过了设定的字段长度 10，那么不会报错，并且取前 10 个字符存上，也就是说你这个数据被存为了<code>1234567890</code>，而<code>abc</code>就没有了。但是我们给的这条数据是错误的，因为超过了字段长度，但是并没有报错，并且 mysql 自行处理并接受了，这就是宽松模式的效果。</p></blockquote><hr><h4 id="严格模式" tabindex="-1"><a class="header-anchor" href="#严格模式" aria-hidden="true">#</a> 严格模式</h4><p>  出现上面宽松模式的错误，应该报错才对，所以 MySQL5.7 版本就将 sql_mode 默认值改为了严格模式。所以<mark>在生产等环境中，我们必须采用的是严格模式</mark>，进而开发、测试环境的数据库也必须要设置，这样在开发测试阶段就可以发现问题。并且我们即便是用的 MySQL5.6，也应该自行将其改为严格模式。</p><blockquote><p>开发经验 ：MySQL 等数据库总想把关于数据的所有操作都自己包揽下来，包括数据的校验，其实开发中，我们应该在自己 开发的项目程序级别将这些校验给做了 ，虽然写项目的时候麻烦了一些步骤，但是这样做之后，我们在进行数据库迁移或者在项目的迁移时，就会方便很多。</p></blockquote><div class="hint-container warning"><p class="hint-container-title">改为严格模式后可能会存在的问题</p><p>  若设置模式中包含了 <code>NO_ZERO_DATE</code> ，那么 MySQL 数据库不允许插入零日期，插入零日期会抛出错误而不是警告。例如，表中含字段 TIMESTAMP 列（如果未声明为 NULL 或显示 DEFAULT 子句）将自动分配 DEFAULT &#39;0000-00-00 00:00:00&#39;（零时间戳），这显然是不满足 sql_mode 中的 <code>NO_ZERO_DATE</code> 而报错。</p></div><h3 id="模式查看和设置" tabindex="-1"><a class="header-anchor" href="#模式查看和设置" aria-hidden="true">#</a> 模式查看和设置</h3><p>查看当前的 sql_mode：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@session.sql_mode</span><span class="token punctuation">;</span> <span class="token comment"># 会话变量</span>
<span class="token keyword">select</span> @<span class="token variable">@global.sql_mode</span><span class="token punctuation">;</span> <span class="token comment"># 全局变量</span>

<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;sql_mode&#39;</span><span class="token punctuation">;</span>
</code></pre></div><p>设置方式：</p><div class="language-sql" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> sql_mode <span class="token operator">=</span> <span class="token string">&#39;modes...&#39;</span><span class="token punctuation">;</span> <span class="token comment"># 全局</span>
<span class="token keyword">SET</span> <span class="token keyword">SESSION</span> sql_mode <span class="token operator">=</span> <span class="token string">&#39;modes...&#39;</span><span class="token punctuation">;</span> <span class="token comment"># 当前会话</span>

<span class="token comment">-- 例如</span>
<span class="token comment"># 改为严格模式(只在当前会话中生效，关闭当前会话就不生效了)</span>
<span class="token keyword">SET</span> <span class="token keyword">SESSION</span> sql_mode<span class="token operator">=</span><span class="token string">&#39;STRICT_TRANS_TABLES&#39;</span><span class="token punctuation">;</span>

<span class="token comment"># 改为严格模式(在当前服务中生效，重启MySQL服务后失效。)</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> sql_mode<span class="token operator">=</span><span class="token string">&#39;STRICT_TRANS_TABLES&#39;</span><span class="token punctuation">;</span>
</code></pre></div><p>永久设置方式：</p><p>在<code>my.cnf</code>文件(Windows 环境下是<code>my.ini</code>文件)中增加：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">sql_mode</span><span class="token operator">=</span>ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR _DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后<mark>重启 MySQL</mark>。</p><p>  当然生产环境上是禁止重启 MySQL 服务的，所以采用<mark>临时设置方式 + 永久设置</mark>方式来解决线上的问题，那么即便是有一天真的重启了 MySQL 服务，也会永久生效了。</p><h4 id="常用的-sql-mode" tabindex="-1"><a class="header-anchor" href="#常用的-sql-mode" aria-hidden="true">#</a> 常用的 sql_mode</h4><p>(1) <strong>ONLY_FULL_GROUP_BY</strong>：</p><blockquote><p>GROUP BY 聚合查询中如果 SELECT 中的列没在 GROUP BY 子句中，那么这个 SQL 是非法的</p></blockquote><p>(2) <strong>NO_AUTO_VALUE_ON_ZERO</strong>：</p><blockquote><p>在自增列上插入数值 0 时，实际插入的值为 0。如果不设置该模式则在自增列上插入数值 0 或 NULL 时都会插入实际自增的值</p></blockquote><p>(3) <strong>NO_ENGINE_SUBSTITUTION</strong>：</p><blockquote><p>指定的存储引擎不存在则报错，如果不设置该模式则在指定的存储引擎不存在时使用 InnoDB 引擎</p></blockquote><p>(4) <strong>ANSI</strong>：</p><blockquote><p>宽松模式，会更改不符合条件的数据。也就是说数据如果不符合定义的类型或长度，会对数据的类型进行调整或截断保存，报 warning 警告。对于以除数为 0 的计算结果为值的字段值，数据库会用 NULL 值代替</p></blockquote><p>(5) <strong>STRICT_TRANS_TABLES</strong>：</p><blockquote><p>支持事务的引擎（如 InnoDB）严格检查数据类型，不支持事务的引擎（如 MyISAM）批量操作时，根据第 1 条数据是否成功决定后面的数据类型检查失败时是否使用宽松模式处理。也就是说：如果第 1 条执行成功，那么后面的操作即使数据类型检查失败也使用宽松模式处理；如果第 1 条执行失败，那么即使后面的操作数据类型检查成功也不执行</p></blockquote><p>(6) <strong>STRICT_ALL_TABLES 或 TRADITIONAL</strong>：</p><blockquote><p>支持事务的引擎（如 InnoDB）严格检查数据类型，不支持事务的引擎（如 MyISAM）批量操作时，数据类型检查失败的那条数据之后的所有数据操作都不执行，即使数据类型检查失败的那条数据之后有检查成功的数据，这些成功的数据也不执行</p></blockquote><p>(7) <strong>NO_ZERO_IN_DATE</strong>：</p><blockquote><p>在 STRICT 模式下，日期中的月、日不能为 0，但 0000-00-00 除外</p></blockquote><p>(8) <strong>NO_ZERO_DATE</strong>：</p><blockquote><p>在 STRICT 模式下，日期不能设置为 0000-00-00</p></blockquote><p>(9) <strong>ERROR_FOR_DIVISION_BY_ZERO</strong>：</p><blockquote><p>除数不能为 0，如果不设置该模式则返回 NULL</p></blockquote><p>(10) <strong>NO_AUTO_CREATE_USER</strong>：</p><blockquote><p>禁止创建密码为空的新用户</p></blockquote><p>(11) <strong>PIPES_AS_CONCAT</strong>：</p><blockquote><p>将&quot;||&quot;视为字符串的连接操作符而非或运算符</p></blockquote><p>(12) <strong>ANSI_QUOTES</strong>：</p><blockquote><p>可以用双引号来括数据库的对象名，比如表名，列表，这样就不能用双引号来引用字符串了</p></blockquote>`,157);function I(Q,C){const p=e("ExternalLinkIcon"),o=e("RouterLink");return l(),r("div",null,[A,s("p",null,[a("① 下载地址："),s("a",O,[a("https://dev.mysql.com/downloads/"),t(p)])]),R,s("p",null,[a("  进行上面排查后，重新进行连接，如果连接报错"),M,a("，分析是 MySQL 密码加密方法变了。解决方法参考 ："),t(o,{to:"/backend/database/base/environment_building.html#authentication-plugin-caching-sha2-password-cannot-be-loaded"},{default:d(()=>[a("基础篇环境搭建")]),_:1})]),N])}const B=c(T,[["render",I],["__file","install_and_uninstall.html.vue"]]);export{B as default};
